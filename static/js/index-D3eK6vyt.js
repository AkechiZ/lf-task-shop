var e=Object.defineProperty,t=(t,s,r)=>(((t,s,r)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r})(t,"symbol"!=typeof s?s+"":s,r),r);import{j as s}from"./react-Bi74NbOF.js";import{z as r}from"./antd-C9CE_-AR.js";/* empty css             */import{c as i,p as n,i as a}from"./zustand-CmrVNLMw.js";import{u as l,Q as c,a as o}from"./@tanstack-DNylXuQ7.js";import{n as d}from"./@emotion-g_Fc7SoU.js";import{S as u}from"./@ant-design-Ci8zoZ5n.js";import"./@babel-DQ7tBuk8.js";import"./rc-pagination-i0B0XGAm.js";import"./rc-picker-DbPdAi0o.js";import"./use-sync-external-store-9vKPV6GC.js";import"./immer-DzuUjzr-.js";import"./stylis-0hzdg11A.js";import"./classnames-RrD-SoDV.js";import"./@ctrl-G4xHZZGI.js";import"./rc-util-R-jdSMKA.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const p=(e,t)=>({sizes:[],sort:[{property:"price",order:"desc"}],setSize:t=>{e((()=>({sizes:t})))},setSort:t=>{e((()=>({sort:t})))}}),m=(e,t)=>({show:!1,subtotal:0,products:{},addProduct:(s,r,i=1)=>{var n;(null==(n=t().products[s.sku])?void 0:n[r])?t().increase(s.sku.toString(),r):e((e=>{var t,n;return(t=e.products)[n=s.sku]??(t[n]={}),e.products[s.sku][r]={amount:i,product:s,size:r},e}))},changeProductAmount:(s,r,i)=>{var n;(null==(n=t().products[s])?void 0:n[r])&&e((e=>(e.products[s][r].amount=i,e)))},increase:(s,r,i=1)=>{var n;(null==(n=t().products[s])?void 0:n[r])&&e((e=>(e.products[s][r].amount+=i,e)))},removeProdcut:(t,s)=>{e((e=>{var r;return(null==(r=e.products[t])?void 0:r[s])&&delete e.products[t][s],e}))},clearCart:()=>{e((()=>({products:{}})))},showCart:(t=!0)=>{e({show:t})}}),h=i(n(a(((...e)=>({...m(...e),...p(...e)}))),{name:"cart-store"})),x=["XS","S","M","ML","L","XL","XXL"].map((e=>({label:e,value:e}))),f=()=>{const[e,t]=h((e=>[e.sizes,e.setSize])),[r,i]=h((e=>[e.sort,e.setSort])),[n]=r;return s.jsxs(antd.Form,{children:[s.jsx(antd.Form.Item,{className:"mb-4",label:"尺寸",children:s.jsx(antd.Checkbox.Group,{className:"sm:block",value:e,options:x,onChange:e=>{t(e)}})}),s.jsx(antd.Form.Item,{className:"mb-4",label:"价格",children:s.jsxs(antd.Radio.Group,{value:n.order,onChange:e=>{i([{order:e.target.value,property:"price"}])},children:[s.jsx(antd.Radio.Button,{value:"asc",children:"按价格升序"}),s.jsx(antd.Radio.Button,{value:"desc",children:"按价格降序"})]})})]})},y={data:{products:[{availableSizes:["X","L","XL","XXL"],currencyFormat:"$",currencyId:"USD",description:"14/15 s/nº",id:0,installments:9,isFreeShipping:!0,price:10.9,sku:8552515751438644,style:"White T-shirt",title:"Cropped Stay Groovy off white"},{availableSizes:["X","ML","L"],currencyFormat:"$",currencyId:"USD",description:"",id:11,installments:3,isFreeShipping:!0,price:13.25,sku:0x8daba6bd130cc8,style:"Wine",title:"Basic Cactus White T-shirt"},{availableSizes:["XL"],currencyFormat:"$",currencyId:"USD",description:"14/15 s/nº - Jogador",id:4,installments:12,isFreeShipping:!1,price:25.9,sku:9197907543445676,style:"Tony Hawk",title:"Skater Black Sweatshirt"},{availableSizes:["M","ML"],currencyFormat:"$",currencyId:"USD",description:"",id:13,installments:5,isFreeShipping:!0,price:29.45,sku:0xb6f59698a199a0,style:"Tule",title:"Black Tule Oversized"},{availableSizes:["S","XS"],currencyFormat:"$",currencyId:"USD",description:"4 MSL",id:12,installments:9,isFreeShipping:!0,price:10.9,sku:0x2adc647508bf40,style:"Really Cool T-shirt",title:"Black Batman T-shirt"},{availableSizes:["X","L","XL"],currencyFormat:"$",currencyId:"USD",description:"GPX Poly 1",id:14,installments:3,isFreeShipping:!0,price:9,sku:0x25f72ecf59ef90,style:"Mark Zuck have 365 of this one",title:"Blue T-Shirt"},{availableSizes:["X","L","XL","XXL"],currencyFormat:"$",currencyId:"USD",description:"Treino 2014",id:15,installments:5,isFreeShipping:!0,price:14,sku:0x27334c4ea25688,style:"",title:"Loose Black T-shirt"},{availableSizes:["X","L","XL","XXL"],currencyFormat:"$",currencyId:"USD",description:"14/15 s/nº",id:1,installments:9,isFreeShipping:!0,price:10.9,sku:0x423cba4dd80bb0,style:"White T-shirt",title:"Ringer Hall Pass"},{availableSizes:["X","L"],currencyFormat:"$",currencyId:"USD",description:"14/15 s/nº",id:2,installments:7,isFreeShipping:!0,price:14.9,sku:0x2a1d389d2959e0,style:"You will like this one",title:"Grey T-shirt"},{availableSizes:["X","L"],currencyFormat:"$",currencyId:"USD",description:"2014 s/nº",id:3,installments:7,isFreeShipping:!0,price:14.9,sku:876661122392077,style:"Adidas originals",title:"Black T-shirt with white stripes"},{availableSizes:["X","L","XL"],currencyFormat:"$",currencyId:"USD",description:"14/15 + Camiseta 1º Mundial",id:5,installments:9,isFreeShipping:!1,price:10.9,sku:0x257950af4003a8,style:"Cowabunga!",title:"Turtles Ninja T-shirt"},{availableSizes:["XL","XXL"],currencyFormat:"$",currencyId:"USD",description:"T-shirt 13/14",id:6,installments:0,isFreeShipping:!0,price:49.9,sku:6090484789343891,style:"When you wish well",title:"Slim black T-shirt"},{availableSizes:["S"],currencyFormat:"$",currencyId:"USD",description:"1977 Infantil",id:7,installments:4,isFreeShipping:!0,price:22.5,sku:0x41d75d518e54e0,style:"Very comfy",title:"Blue Sweatshirt"},{availableSizes:["XL"],currencyFormat:"$",currencyId:"USD",description:"",id:8,installments:4,isFreeShipping:!1,price:18.7,sku:5619496040738316,style:"Girl the future is all your",title:"White T-shirt Gucci"},{availableSizes:["L","XL"],currencyFormat:"$",currencyId:"USD",description:"",id:9,installments:5,isFreeShipping:!0,price:134.9,sku:0x293708673b8244,style:"",title:"Tropical Wine T-shirt"},{availableSizes:["L","XL"],currencyFormat:"$",currencyId:"USD",description:"",id:10,installments:9,isFreeShipping:!0,price:49,sku:0x60cfce39710dcc,style:"",title:"Marine Blue T-shirt"}]}};const j=new class{constructor(){t(this,"mockError",!1)}getProducts(e,t){return new Promise(((s,r)=>{var i;let n=[...y.data.products];(null==(i=null==e?void 0:e.sizes)?void 0:i.length)&&(n=n.filter((t=>t.availableSizes.some((t=>{var s;return null==(s=e.sizes)?void 0:s.includes(t)}))))),(null==t?void 0:t.sort)&&t.sort.forEach((e=>{n.sort(((t,s)=>(t[e.property]>=s[e.property]?1:-1)*("asc"===e.order?1:-1)))}));const a=Math.floor(2*Math.random())+1;setTimeout((()=>{this.mockError&&Math.random()>.5&&r(new Error("未知错误")),s(n)}),1e3*a)}))}},v=()=>h((e=>Object.values(e.products).reduce(((e,t)=>e+=Object.values(t).reduce(((e,t)=>e+=t.amount),0)),0))),g=d.div((e=>({position:"relative",paddingTop:"145.45%",borderRadius:"8px 8px 0 0",backgroundImage:`url(${"./static/products/"+e.sku+"-1-product.webp"})`,"&:hover":{backgroundImage:`url(${"./static/products/"+e.sku+"-2-product.webp"})`}}))),b=d(antd.Skeleton.Image)`
  width: 100% !important;
  height: 256px !important;
  border-radius: 8px 8px 0 0;

  > .ant-skeleton-image {
    width: 100%;
    height: 100%;
  }
`,S=d.div`
  position: absolute;
  top: 0;
  right: 0;
  padding: 2px 4px;
  border-top-right-radius: 8px;
  color: #fff;
  background-color: #000;
  font-size: 12px;
`,k=d.div`
  position: absolute;
  bottom: 8px;
  left: 8px;
  display: flex;
`,w=d.button`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  margin: 2px 2px;
  color: #fff;
  background-color: ${e=>e.active?"#1677ff":"#000"};
  font-size: 12px;
`,F=d.div`
  display: flex;
  justify-content: end;
  align-items: center;
  height: 100%;
  line-height: initial;
`,L=d.button`
  display: flex;
  justify-content: center;
  align-items: center;
  color: #fff;
  padding: 8px;
  border-radius: 8px;
  font-size: 32px;
  background-color: transparent;
  border: none;

  &:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  &:active {
    background-color: rgba(255, 255, 255, 0.2)
  }
`,N=e=>{const{message:t}=antd.App.useApp(),[r,i]=React.useState(e.data.availableSizes[0]),n=h((e=>e.addProduct)),{data:a}=e,[l,c]=String(a.price.toFixed(2)).split(".");return s.jsx(antd.Card,{className:"relative",cover:s.jsxs(g,{sku:a.sku,children:[a.isFreeShipping&&s.jsx(S,{"data-testid":"freeshipping",children:"包邮"}),a.availableSizes.length>0&&s.jsx(k,{children:a.availableSizes.map((e=>s.jsx(w,{active:r===e,onClick:()=>{i(e)},children:e},e)))})]}),children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("p",{className:"h-12 overflow-hidden",children:a.title}),s.jsxs("p",{children:[s.jsx("span",{className:"text-xs",children:a.currencyFormat}),s.jsx("span",{className:"text-2xl font-bold",children:l}),s.jsxs("span",{className:"text-base",children:[".",c]})]}),a.installments>0?s.jsxs("p",{"data-testid":"installments",className:"text-gray-500 text-sm",children:["或分 ",a.installments," 期，每期",s.jsxs("span",{className:"font-bold",children:["$",(a.price/a.installments).toFixed(2)]})]}):s.jsx("div",{className:"text-sm whitespace-pre",children:" "}),s.jsx(antd.Button,{"data-testid":"add-product",className:"mt-2",type:"primary",ghost:!0,block:!0,onClick:()=>{n(a,r),t.success&&t.success(`「${a.title} - ${r}」已添加到购物车`)},children:"添加到购物车"})]})})},z=()=>{const{data:e,isLoading:t,error:r,refetch:i}=(()=>{const[e,t]=h((e=>[e.sizes,e.sort]));return l({queryKey:["products",{sizes:e,sort:t}],queryFn:()=>j.getProducts({sizes:e},{sort:t}),staleTime:5e3,retry:!1})})();return t?s.jsx(antd.Row,{gutter:[16,16],children:Array.from({length:8}).map(((e,t)=>s.jsx(antd.Col,{xs:12,sm:8,md:6,children:s.jsx(antd.Card,{"data-testid":"loading-card",cover:s.jsx(b,{active:!0}),children:s.jsx(antd.Skeleton,{active:!0})})},t)))}):r?s.jsxs("div",{className:"flex flex-col items-center py-6",children:[s.jsx(antd.Empty,{description:"获取商品失败，请重新查询"}),s.jsx(antd.Button,{className:"mt-4",type:"primary",onClick:()=>{i()},children:"重试"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"my-2",children:["共找到 ",(null==e?void 0:e.length)??0," 个商品"]}),s.jsx(antd.Row,{gutter:[16,16],children:null==e?void 0:e.map((e=>s.jsx(antd.Col,{span:6,lg:6,md:8,sm:12,xs:12,children:s.jsx(N,{data:e})},e.id)))})]})},$=e=>{const{amount:t,product:r,size:i}=e,n=h((e=>e.changeProductAmount));return s.jsxs("div",{"data-testid":"cart-product",className:"flex items-start overflow-hidden",children:[s.jsx("img",{className:"w-16 h-24 object-cover",src:`static/products/${r.sku}-1-product.webp`,alt:""}),s.jsxs("div",{className:"ml-2 flex-auto overflow-hidden",children:[s.jsx("h4",{className:"text-base overflow-hidden text-ellipsis whitespace-nowrap",children:r.title}),s.jsxs("div",{className:"text-gray-500 overflow-hidden text-ellipsis whitespace-nowrap",children:[i," ",r.style&&s.jsxs(s.Fragment,{children:["| ",r.style]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-xs",children:r.currencyFormat}),s.jsx("span",{className:"text-sm font-bold",children:r.price.toFixed(2)})]}),s.jsxs("div",{className:"flex items-center",children:["数量：",s.jsx(antd.InputNumber,{className:"w-14",value:t,size:"small",step:1,min:1,onChange:e=>{null!=e&&n(r.sku.toString(),i,e)}})]})]})]})},X=e=>{const t=Object.entries(e.value),r=h((e=>e.removeProdcut));return 0===(t.filter((([e,t])=>0!==Object.keys(t).length)).length??0)?s.jsx("div",{className:"py-8",children:s.jsx(antd.Empty,{description:"请添加商品到购物车"})}):s.jsx(antd.List,{children:t.map((([e,t])=>s.jsx(React.Fragment,{children:Object.entries(t).map((([t,i])=>s.jsx(antd.List.Item,{extra:s.jsx(antd.Button,{type:"text",danger:!0,onClick:()=>{r(e,t)},children:"删除"}),children:s.jsx($,{product:i.product,amount:i.amount,size:i.size})},t)))},e)))})},C=e=>s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{children:"小计"}),s.jsxs("div",{className:"flex-auto text-right",children:[s.jsxs("div",{className:"text-lg font-bold",children:["$ ",e.value.toFixed(2)]}),e.installments&&s.jsxs("div",{className:"text-s",children:["或最少 ",s.jsxs("span",{className:"text-base font-bold",children:["$ ",e.installments]}),"/月"]})]})]}),I=()=>{const e=h((e=>e.products)),t=h((e=>e.clearCart)),r=v(),i=h((e=>Object.values(e.products).reduce(((e,t)=>e+Object.values(t).reduce(((e,t)=>e+t.product.price*t.amount),0)),0))),n=h((e=>{const t=Object.values(e.products).flatMap((e=>Object.values(e).map((e=>e.amount*e.product.price/e.product.installments)))).reduce(((e,t)=>e+t),0);return(Math.ceil(100*t)/100).toFixed(2)})),{modal:a,message:l}=antd.App.useApp();return s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsx("div",{className:"flex-auto px-2 min-h-0 overflow-y-auto",children:s.jsx(X,{value:e})}),s.jsxs("div",{className:"flex-none flex flex-col p-2 bg-gray-200",children:[s.jsx(C,{value:i,installments:n}),s.jsx(antd.Button,{type:"primary",ghost:!0,block:!0,onClick:()=>{Object.keys(e).length?a.confirm({title:"结算",content:`共 ${r} 件商品，总计 $${i}，确定结算？`,onOk(){t(),l.success(`结算完成，共支付 $${i}`)}}):l.info("购物车是空的，请添加你心仪的商品到购物车吧")},children:"结算"})]})]})};function T(){const[e,t]=h((e=>[e.show,e.showCart])),r=v();return s.jsxs(antd.Layout,{className:"min-h-full",children:[s.jsx(antd.Layout.Header,{className:"z-10 sticky top-0 w-full px-4 lg:px-8",children:s.jsxs("div",{className:"flex items-center h-full bg-black",children:[s.jsx("div",{className:"text-lg text-white",children:"江南服装厂"}),s.jsx(F,{className:"flex-auto",children:s.jsx(L,{onClick:()=>{t()},children:s.jsx(antd.Badge,{count:r,children:s.jsx(u,{className:"text-3xl text-white align-middle"})})})})]})}),s.jsx(antd.Layout.Content,{children:s.jsxs("div",{className:"flex flex-col max-w-5xl mx-auto p-4",children:[s.jsx(f,{}),s.jsx(z,{})]})}),s.jsx(antd.Drawer,{open:e,onClose:()=>t(!1),title:"购物车",placement:"right",children:s.jsx(I,{})})]})}const P=new c({defaultOptions:{queries:{refetchOnWindowFocus:!1}}}),O=e=>s.jsx(o,{client:P,children:e.children}),B={};var D;ReactDOM.createRoot(document.getElementById("root")).render(s.jsx(React.StrictMode,{children:s.jsx(antd.ConfigProvider,{locale:r,children:s.jsx(antd.App,{children:s.jsx(O,{children:s.jsx(T,{})})})})})),D&&D instanceof Function&&function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),n=(null==i?void 0:i.nonce)||(null==i?void 0:i.getAttribute("nonce"));r=Promise.all(t.map((t=>{if((t=function(e){return"/lf-task-shop/"+e}(t))in B)return;B[t]=!0;const r=t.endsWith(".css"),i=r?'[rel="stylesheet"]':"";if(s)for(let s=e.length-1;s>=0;s--){const i=e[s];if(i.href===t&&(!r||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;const a=document.createElement("link");return a.rel=r?"stylesheet":"modulepreload",r||(a.as="script",a.crossOrigin=""),a.href=t,n&&a.setAttribute("nonce",n),document.head.appendChild(a),r?new Promise(((e,s)=>{a.addEventListener("load",e),a.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}return r.then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))}((()=>import("./web-vitals-li3l08Vc.js")),[]).then((({getCLS:e,getFID:t,getFCP:s,getLCP:r,getTTFB:i})=>{e(D),t(D),s(D),r(D),i(D)}));
